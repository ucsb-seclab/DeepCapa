# CFG Generation

## Overview

To generate a Control Flow Graph (CFG), we first load the memory snapshot bundle into IDA using a custom loader. This bundle contains all memory snapshots from the process packed together.

Currently, our IDA loader supports only memory snapshots generated by Lastline's sandbox. However, once you understand the loading process, it can be easily adapted to work with memory snapshots from other sources (e.g., Cuckoo, VirusTotal).
Loading Process

The loading process involves two steps:

- Mapping Memory Regions: We first map all memory regions marked as executable and make IDA to load them as code.
- CFG Extraction: We then use a custom IDA plugin (written by us) to parse and dump the CFG generated by IDA for each function.

## Code Components

- cfg_extractor: Contains the IDA plugin for extracting CFGs.
- llprocess_snapshot_loader: Code for loading memory snapshots into IDA. needs to be placed in the loaders directory of ida
- run: Script to automate the launching of IDA for CFG dumping.

## Database Integration

To manage large-scale automated loading and extraction of CFGs from memory snapshots, we use MongoDB for synchronization and storage, along with RabbitMQ for messaging.

## Note:
Our current code expects MongoDB server with rabbit-mq running on the local machine

## Future Work
Add support for running IDA in headless mode [link](https://github.com/DennyDai/headless-ida). 